â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  MiniRT STRUCTURE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚     t_scene      â”‚
                              â”‚ (Complete Scene) â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚       â”‚       â”‚                 â”‚                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚t_ambientâ”‚    â”‚ t_camera â”‚   â”‚  â”‚t_light[]â”‚    â”‚  t_object*   â”‚    â”‚ t_vec3   â”‚
        â”‚         â”‚    â”‚          â”‚   â”‚  â”‚         â”‚    â”‚  (linked     â”‚    â”‚backgroundâ”‚
        â”‚â€¢ ratio  â”‚    â”‚â€¢ positionâ”‚   â”‚  â”‚â€¢ positionâ”‚   â”‚   list)      â”‚    â”‚â€¢ rgb     â”‚
        â”‚â€¢ color  â”‚    â”‚â€¢ forward â”‚   â”‚  â”‚â€¢ color   â”‚   â”‚              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚â€¢ up      â”‚   â”‚  â”‚â€¢ brightness   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚â€¢ right   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                       â”‚â€¢ fov     â”‚   â”‚                          â”‚
                       â”‚â€¢ aspect_ â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
                       â”‚  ratio   â”‚   â””â”€â–¶â”‚light_count  â”‚         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                                                 â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  t_object   â”‚ â—„â”€â” (next pointer creates
                   â”‚             â”‚   â”‚  linked list of objects)
                   â”‚â€¢ type       â”‚â”€â”€â”€â”˜
                   â”‚â€¢ data (union)â”‚
                   â”‚â€¢ next       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚           â”‚           â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ t_sphere  â”‚ â”‚ t_plane â”‚ â”‚ t_cylinder  â”‚ â”‚ t_cone  â”‚
        â”‚           â”‚ â”‚         â”‚ â”‚             â”‚ â”‚(BONUS)  â”‚
        â”‚â€¢ center   â”‚ â”‚â€¢ point  â”‚ â”‚â€¢ center     â”‚ â”‚â€¢ apex   â”‚
        â”‚â€¢ radius   â”‚ â”‚â€¢ normal â”‚ â”‚â€¢ axis       â”‚ â”‚â€¢ axis   â”‚
        â”‚â€¢ material â”‚ â”‚â€¢ materialâ”‚â”‚â€¢ radius     â”‚ â”‚â€¢ angle  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â€¢ height     â”‚ â”‚â€¢ height â”‚
              â”‚           â”‚       â”‚â€¢ material   â”‚ â”‚â€¢ materialâ”‚
              â”‚           â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚           â”‚             â”‚               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      t_material         â”‚
                    â”‚   (Surface Properties)  â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ color (t_vec3)        â”‚ â—„â”€â”€ Base RGB color
                    â”‚   - x (red)             â”‚
                    â”‚   - y (green)           â”‚
                    â”‚   - z (blue)            â”‚
                    â”‚                         â”‚
                    â”‚ PHONG LIGHTING MODEL:   â”‚
                    â”‚ â€¢ ambient [0-1]         â”‚ â—„â”€â”€ Base illumination
                    â”‚ â€¢ diffuse [0-1]         â”‚ â—„â”€â”€ Matte reflection
                    â”‚ â€¢ specular [0-1]        â”‚ â—„â”€â”€ Shiny reflection
                    â”‚ â€¢ shininess             â”‚ â—„â”€â”€ Highlight sharpness
                    â”‚                         â”‚
                    â”‚ PATTERN SYSTEM (BONUS): â”‚
                    â”‚ â€¢ pattern_type          â”‚ â—„â”€â”€ SOLID/CHECKERBOARD/
                    â”‚   - PATTERN_SOLID       â”‚     STRIPES/GRADIENT
                    â”‚   - PATTERN_CHECKERBOARDâ”‚
                    â”‚   - PATTERN_STRIPES     â”‚
                    â”‚   - PATTERN_GRADIENT    â”‚
                    â”‚ â€¢ pattern_color2        â”‚ â—„â”€â”€ Second pattern color
                    â”‚ â€¢ pattern_scale         â”‚ â—„â”€â”€ Pattern size
                    â”‚ â€¢ bump (bool)           â”‚ â—„â”€â”€ Bump mapping flag
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              RAY-OBJECT INTERSECTION                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  t_ray  â”‚â”€â”€â”€â”€â”€â–¶â”‚ intersect_   â”‚â”€â”€â”€â”€â”€â–¶â”‚   t_hit     â”‚
    â”‚         â”‚      â”‚ object()     â”‚      â”‚             â”‚
    â”‚â€¢ origin â”‚      â”‚              â”‚      â”‚â€¢ hit (bool) â”‚
    â”‚â€¢ directionâ”‚     â”‚â€¢ sphere      â”‚     â”‚â€¢ t (distance)â”‚
    â”‚â€¢ t_min   â”‚     â”‚â€¢ plane       â”‚      â”‚â€¢ point      â”‚
    â”‚â€¢ t_max   â”‚     â”‚â€¢ cylinder    â”‚      â”‚â€¢ normal     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚â€¢ cone        â”‚      â”‚â€¢ material*  â”‚â—„â”€â”
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚â€¢ object*    â”‚  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                           â”‚
                                    Points back to the â”€â”€â”€â”˜
                                    material of the 
                                    intersected object



â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        START render_scene           â”‚
â”‚    (minirt structure passed in)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Initialize y = 0            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        y < minirt->height?          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
              â”‚ YES                               â”‚
              â–¼                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚         Initialize x = 0            â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                  â”‚                               â”‚
                  â–¼                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚        x < minirt->width?           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
              â”‚ YES                             â”‚ â”‚
              â–¼                                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  Generate ray from camera through   â”‚         â”‚ â”‚
â”‚  pixel (x,y) using generate_ray()   â”‚         â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
                  â”‚                             â”‚ â”‚
                  â–¼                             â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚   Find closest intersection with     â”‚         â”‚ â”‚
â”‚   all objects using intersect_scene()â”‚         â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
                  â”‚                             â”‚ â”‚
                  â–¼                             â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚         hit.hit == true?            â”‚         â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
          â”‚ YES           â”‚ NO                  â”‚ â”‚
          â–¼               â–¼                     â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚    SHADING    â”‚  â”‚ Use background  â”‚         â”‚ â”‚
â”‚   PIPELINE    â”‚  â”‚ color (black)   â”‚         â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
        â”‚                    â”‚                 â”‚ â”‚
        â–¼                    â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                 â”‚ â”‚
â”‚ Initialize      â”‚          â”‚                 â”‚ â”‚
â”‚ final_color = 0 â”‚          â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                 â”‚ â”‚
      â”‚                      â”‚                 â”‚ â”‚
      â–¼                      â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                 â”‚ â”‚
â”‚ AMBIENT         â”‚          â”‚                 â”‚ â”‚
â”‚ LIGHTING        â”‚          â”‚                 â”‚ â”‚
â”‚ final_color +=  â”‚          â”‚                 â”‚ â”‚
â”‚ ambient_ratio * â”‚          â”‚                 â”‚ â”‚
â”‚ material.color  â”‚          â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚                 â”‚ â”‚
      â”‚                      â”‚                 â”‚ â”‚
      â–¼                      â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚                 â”‚ â”‚
â”‚ For each light  â”‚          â”‚                 â”‚ â”‚
â”‚ in scene.lights â”‚â—„â”€â”€â”€â”€â”€â”   â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚                 â”‚ â”‚
      â”‚                  â”‚   â”‚                 â”‚ â”‚
      â–¼                  â”‚   â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚                 â”‚ â”‚
â”‚ Calculate light â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ direction from  â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ hit.point to    â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ light.position  â”‚      â”‚   â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚                 â”‚ â”‚
      â”‚                  â”‚   â”‚                 â”‚ â”‚
      â–¼                  â”‚   â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚                 â”‚ â”‚
â”‚ SHADOW TEST     â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ Cast shadow ray â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ from hit.point  â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ to light        â”‚      â”‚   â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚                 â”‚ â”‚
      â”‚                  â”‚   â”‚                 â”‚ â”‚
      â–¼                  â”‚   â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚                 â”‚ â”‚
â”‚ Shadow ray hits â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ object before   â”‚      â”‚   â”‚                 â”‚ â”‚
â”‚ reaching light? â”‚      â”‚   â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚   â”‚                 â”‚ â”‚
      â”‚YES  â”‚NO          â”‚   â”‚                 â”‚ â”‚
      â–¼     â–¼            â”‚   â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚                 â”‚ â”‚
â”‚ Skip    â”‚ â”‚ DIFFUSE  â”‚ â”‚   â”‚                 â”‚ â”‚
â”‚ this    â”‚ â”‚ LIGHTING â”‚ â”‚   â”‚                 â”‚ â”‚
â”‚ light   â”‚ â”‚ Calculateâ”‚ â”‚   â”‚                 â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â”‚ Lambert  â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ cosine   â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ law      â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚   â”‚                 â”‚ â”‚
      â”‚           â–¼      â”‚   â”‚                 â”‚ â”‚
      â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ SPECULAR â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ LIGHTING â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ Calculateâ”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ Phong    â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ specular â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ highlightâ”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚   â”‚                 â”‚ â”‚
      â”‚           â–¼      â”‚   â”‚                 â”‚ â”‚
      â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ Add      â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ diffuse +â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ specular â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚ to       â”‚ â”‚   â”‚                 â”‚ â”‚
      â”‚     â”‚final_colorâ”‚   â”‚                 â”‚ â”‚
      â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚   â”‚                 â”‚ â”‚
      â”‚           â”‚      â”‚   â”‚                 â”‚ â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜   â”‚                 â”‚ â”‚
                  â”‚          â”‚                 â”‚ â”‚
                  â–¼          â”‚                 â”‚ â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                 â”‚ â”‚
            â”‚ More     â”‚     â”‚                 â”‚ â”‚
            â”‚ lights?  â”‚â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â”‚ â”‚
                  â”‚ NO                         â”‚ â”‚
                  â–¼                            â”‚ â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚ â”‚
            â”‚ MATERIAL â”‚                       â”‚ â”‚
            â”‚ EFFECTS  â”‚                       â”‚ â”‚
            â”‚ Apply    â”‚                       â”‚ â”‚
            â”‚ patterns,â”‚                       â”‚ â”‚
            â”‚ bump     â”‚                       â”‚ â”‚
            â”‚ mapping  â”‚                       â”‚ â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â”‚ â”‚
                  â”‚                            â”‚ â”‚
                  â–¼                            â”‚ â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚ â”‚
            â”‚ Clamp    â”‚                       â”‚ â”‚
            â”‚ color    â”‚                       â”‚ â”‚
            â”‚ values   â”‚                       â”‚ â”‚
            â”‚ to 0-255 â”‚                       â”‚ â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â”‚ â”‚
                  â”‚                            â”‚ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                             â”‚                   â”‚
                             â–¼                   â”‚ â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                  â”‚ Convert t_vec3 color to RGB int â”‚ â”‚
                  â”‚        using rgb_to_int()       â”‚ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                    â”‚                 â”‚ â”‚
                                    â–¼                 â”‚ â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                  â”‚    Draw pixel at (x,y) with     â”‚ â”‚ â”‚
                  â”‚     color using put_pixel()     â”‚ â”‚ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                                    â”‚                 â”‚ â”‚
                                    â–¼                 â”‚ â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
                  â”‚           x = x + 1             â”‚ â”‚ â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
                                    â”‚                 â”‚ â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ NO (x >= width)
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           y = y + 1                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ NO (y >= height)
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              END                    â”‚
â”‚        (Final image complete)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


-----------------------------------------------------------------
Ray tracing:
P = vec_origin + t * vec_direction;

-----------------------------------------------------------------
Intersection:

-----------------------------------------------------------------
Final_Ambient = Material_Color Ã— Light_Color Ã— Ambient_Intensity

ğŸ” Formula Breakdown:
Ip = kaÂ·ia + Î£(kdÂ·(LmÂ·N)im,d + ksÂ·(RmÂ·V)^Î± im,s)

ğŸ”´ Ambient Term: kaÂ·ia
ka = Material ambient coefficient (material->ambient)
ia = Ambient light intensity (scene->ambient.ratio Ã— scene->ambient.color)
Result: Base illumination (what we implemented in calculate_ambient())

ğŸ”µ Diffuse Term: kdÂ·(LmÂ·N)im,d
kd = Material diffuse coefficient (material->diffuse)
Lm = Light direction vector (FROM hit point TO light)
N = Surface normal at hit point
LmÂ·N = Dot product (Lambert's cosine law)
im,d = Light intensity for diffuse
Result: Matte reflection (what we implemented in calculate_diffuse())

ğŸŸ¢ Specular Term: ksÂ·(RmÂ·V)^Î± im,s
ks = Material specular coefficient (material->specular)
Rm = Reflection vector of light bouncing off surface
V = View direction (FROM hit point TO camera)
RmÂ·V = Dot product (how aligned reflection is with view direction)
Î± = Shininess exponent (material->shininess)
im,s = Light intensity for specular
Result: Shiny highlights (what we need to implement next)

-------------------------------------------------------
BUMP MAPPING IMPLEMENTATION
-------------------------------------------------------

Bump mapping simulates surface detail by perturbing normals without changing geometry.
Implemented using multi-octave fractal noise (Perlin-like turbulence).

Pipeline: World XYZ â†’ UV Coords â†’ Height Function â†’ Normal Perturbation

CORE FORMULA:
nâ€² = n - (âˆ‚h/âˆ‚u)Â·T - (âˆ‚h/âˆ‚v)Â·B
Where: nâ€²=perturbed normal, n=original, âˆ‚h/âˆ‚u,âˆ‚h/âˆ‚v=height gradients, T,B=tangent basis

IMPLEMENTATION:

1. hash2d(x,y) = frac(sin(xÂ·127.1 + yÂ·311.7) Ã— 43758.5453)
   Generates deterministic pseudo-random values at grid points [0,1]

2. smooth_interp(a,b,t) = aÂ·(1-ft) + bÂ·ft  where ft=(1-cos(tÂ·Ï€))/2
   Cosine interpolation for seamless transitions (S-curve vs linear)

3. smooth_noise(x,y): Bilinear interpolation of 4 grid corners
   Creates continuous noise field from discrete hash values

4. bump_func(u,v): 6-octave fractal accumulation
   for i=0 to 5: result += smooth_noise(uÂ·freqÂ·5, vÂ·freqÂ·5) Ã— amp
                 amp *= 0.5, freq *= 2.0
   Layers noise at different scales: large features â†’ fine details

5. Tangent Space: TNB orthogonal basis aligned with surface
   T=tangent, B=bitangent, N=normal for local coordinate frame

6. Numerical Gradients: âˆ‚h/âˆ‚u â‰ˆ (h(u+Îµ,v)-h(u,v))/Îµ  where Îµ=1e-4
   Computes slope of height field for normal perturbation

RESULT: Natural organic textures with multi-scale detail, proper lighting interaction

-------------------------------------------------------
BUMP function


-------------------------------------------------------
BUMP MAPPING

World Coordinates (XYZ)  â†’  UV Coordinates  â†’  Tangent Space (TNB)
   (3D Global)               (2D Parametric)      (3D Local)


nâ€² â‰ˆ n - (âˆ‚h/âˆ‚u)Â·T - (âˆ‚h/âˆ‚v)Â·B
Where:
â€¢ nâ€² = Perturbed (modified) normal vector
â€¢ n  = Original surface normal
â€¢ âˆ‚h/âˆ‚u = Partial derivative of height function with respect to u
â€¢ âˆ‚h/âˆ‚v = Partial derivative of height function with respect to v
â€¢ T = Tangent vector (direction of u coordinate increase)
â€¢ B = Bitangent vector (direction of v coordinate increase)

-------------------------------------------------------
ğŸ“ UV COORDINATE MAPPING
-------------------------------------------------------

UV coordinates are 2D texture coordinates that map 3D surface points to a 
2D parameter space. Different shapes require different mapping strategies:

1. SPHERE (Latitude-Longitude Mapping)
   
   Formula:
   d = normalize(hit_point - sphere_center)
   u = 0.5 + atan2(d.z, d.x) / (2Ï€)
   v = 0.5 - asin(d.y) / Ï€
   
   Explanation:
   â€¢ d = Direction from sphere center to hit point (unit vector)
   â€¢ u = Longitude (0Â° to 360Â° â†’ mapped to 0 to 1)
     - atan2(z,x) gives angle in XZ plane [-Ï€, Ï€]
     - Divide by 2Ï€ normalizes to [-0.5, 0.5]
     - Add 0.5 shifts to [0, 1]
   â€¢ v = Latitude (90Â°N to 90Â°S â†’ mapped to 0 to 1)
     - asin(y) gives elevation angle [-Ï€/2, Ï€/2]
     - Divide by Ï€ normalizes to [-0.5, 0.5]
     - 0.5 - ... flips direction (v=0 at north pole)

2. PLANE (Planar Projection)
   
   Formula:
   u = hit_point.x Ã— scale
   v = hit_point.z Ã— scale
   
   Explanation:
   â€¢ Directly use world coordinates as UV
   â€¢ Assumes plane normal is along Y axis
   â€¢ Scale controls pattern density
   â€¢ UV repeats infinitely (for checkerboard patterns)
   
   Checkerboard Example:
   check = (floor(u) + floor(v)) % 2
   if (check == 0) color = white; else color = black;

3. CYLINDER (Cylindrical Unwrapping)
   
   Formula:
   d = normalize(hit_point)  [ignore Y component for angle]
   u = atan2(d.z, d.x) / (2Ï€) Ã— scale
   v = hit_point.y Ã— scale
   
   Explanation:
   â€¢ u wraps around cylinder circumference (like a label)
   â€¢ v runs along cylinder height
   â€¢ Similar to sphere longitude, but v is just height

4. CONE (Conical Unwrapping)
   
   Formula:
   d = normalize(hit_point - apex)
   u = atan2(d.z, d.x) / (2Ï€) Ã— scale
   v = length(hit_point - apex) Ã— scale
   
   Explanation:
   â€¢ u wraps around cone base
   â€¢ v is distance from apex (cone tip)


